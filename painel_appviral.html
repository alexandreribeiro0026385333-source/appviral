<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meus Dados - CICLONE PTC</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #2c3e50; color: white; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 30px; padding: 20px; background: #34495e; border-radius: 10px; }
        h1 { color: #1abc9c; }
        .login-section { background: #34495e; padding: 25px; border-radius: 15px; margin-bottom: 30px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: bold; }
        .form-group input { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; }
        .btn { padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; color: white; font-weight: bold; }
        .btn-primary { background: #1abc9c; width: 100%; }
        .btn-primary:hover { background: #16a085; }
        .message { padding: 15px; border-radius: 8px; margin: 15px 0; text-align: center; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .loading { text-align: center; padding: 30px; }
        .user-data { background: #34495e; padding: 25px; border-radius: 15px; margin-top: 20px; display: none; }
        .data-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; }
        .data-item { background: #2c3e50; padding: 15px; border-radius: 8px; }
        .data-label { color: #95a5a6; font-size: 14px; margin-bottom: 5px; }
        .data-value { font-size: 16px; font-weight: bold; }
        .saldo-box { background: #27ae60; padding: 20px; border-radius: 10px; text-align: center; margin-top: 20px; }
        .saldo-label { font-size: 18px; margin-bottom: 10px; }
        .saldo-value { font-size: 36px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üë§ MEUS DADOS - CICLONE PTC</h1>
            <p>Consulte suas informa√ß√µes e saldo</p>
        </div>
        
        <div class="login-section">
            <h2 style="text-align: center; margin-bottom: 20px;">üîë Digite seu e-mail</h2>
            <form id="loginForm">
                <div class="form-group">
                    <input type="email" id="email" name="email" required placeholder="Seu e-mail cadastrado">
                </div>
                
                <button type="submit" class="btn btn-primary" id="loginBtn">
                    Buscar Meus Dados
                </button>
                
                <div class="loading" id="loading" style="display: none;">
                    Buscando seus dados...
                </div>
                
                <div id="message" class="message"></div>
            </form>
        </div>

        <!-- DADOS DO USU√ÅRIO -->
        <div class="user-data" id="userData">
            <h2 style="text-align: center; margin-bottom: 20px; color: #1abc9c;">üìã SEUS DADOS</h2>
            
            <div class="saldo-box">
                <div class="saldo-label">üí∞ SEU SALDO ATUAL</div>
                <div class="saldo-value" id="userSaldo">R$ 0,00</div>
            </div>
            
            <div class="data-grid" id="dataGrid"></div>
        </div>
    </div>

    <script>
        const SUPABASE_URL = "https://dpzxdwzlcrerezmloidk.supabase.co";
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRwenhkd3psY3JlcmV6bWxvaWRrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NjIxNTksImV4cCI6MjA3OTIzODE1OX0.ls_1EaTrSDpgsiKzInPncJe7myMRkHFY71HiozKqxIY";

        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const loginBtn = document.getElementById('loginBtn');
            const loadingDiv = document.getElementById('loading');
            const messageDiv = document.getElementById('message');
            const userDataDiv = document.getElementById('userData');
            const dataGrid = document.getElementById('dataGrid');
            
            if (!email) {
                messageDiv.className = 'message error';
                messageDiv.innerHTML = '‚ùå Digite seu e-mail!';
                messageDiv.style.display = 'block';
                return;
            }
            
            loginBtn.disabled = true;
            loadingDiv.style.display = 'block';
            messageDiv.style.display = 'none';
            userDataDiv.style.display = 'none';
            
            try {
                // Buscar TODOS os dados do usu√°rio pelo email
                const response = await fetch(
                    `${SUPABASE_URL}/rest/v1/appviral?select=*&email=ilike.${encodeURIComponent(email)}`, 
                    {
                        headers: {
                            'apikey': SUPABASE_KEY,
                            'Authorization': `Bearer ${SUPABASE_KEY}`,
                            'Accept': 'application/json'
                        }
                    }
                );
                
                if (!response.ok) throw new Error('Erro ao buscar dados');
                
                const data = await response.json();
                
                if (data.length === 0) {
                    messageDiv.className = 'message error';
                    messageDiv.innerHTML = '‚ùå E-mail n√£o encontrado!';
                    messageDiv.style.display = 'block';
                    loginBtn.disabled = false;
                    loadingDiv.style.display = 'none';
                    return;
                }
                
                const usuario = data[0];
                
                // Mostrar saldo
                document.getElementById('userSaldo').textContent = `R$ ${parseFloat(usuario.saldo || 0).toFixed(2)}`;
                
                // Mostrar todos os dados em grid
                let html = '';
                
                // Dados principais
                const dadosPrincipais = [
                    { label: 'Nome Completo', value: usuario.nome || 'N√£o informado' },
                    { label: 'E-mail', value: usuario.email || 'N√£o informado' },
                    { label: 'Telefone', value: usuario.telefone || 'N√£o informado' },
                    { label: 'Chave PIX', value: usuario.chave_pix || 'N√£o informado' },
                    { label: 'Nome na Conta PIX', value: usuario.pix_nome || 'N√£o informado' },
                    { label: 'C√≥digo de Indica√ß√£o', value: usuario.indicador_code || 'N√£o gerado' },
                    { label: 'Indica√ß√µes Realizadas', value: usuario.indicados_count || 0 },
                    { label: 'B√¥nus Acumulado', value: `R$ ${parseFloat(usuario.bonus || 0).toFixed(2)}` },
                    { label: 'Pr√™mios', value: `R$ ${parseFloat(usuario.premio || 0).toFixed(2)}` },
                    { label: 'Status', value: usuario.status_online ? 'üü¢ Online' : 'üî¥ Offline' },
                    { label: '√öltima Atividade', value: usuario.last_active ? new Date(usuario.last_active).toLocaleString() : 'Nunca' },
                    { label: 'Data de Cadastro', value: usuario.data_cadastro ? new Date(usuario.data_cadastro).toLocaleString() : 'N√£o informada' }
                ];
                
                dadosPrincipais.forEach(item => {
                    html += `
                        <div class="data-item">
                            <div class="data-label">${item.label}</div>
                            <div class="data-value">${item.value}</div>
                        </div>
                    `;
                });
                
                // URLs adicionais se existirem
                if (usuario.blogsite || usuario.urlvideo || usuario.urlnegocio) {
                    html += `<div class="data-item" style="grid-column: 1 / -1; background: #1a252f;">`;
                    html += `<div class="data-label">üìé LINKS ADICIONAIS</div>`;
                    
                    if (usuario.blogsite) {
                        html += `<div class="data-value" style="margin-top: 5px;">üåê Blog: ${usuario.blogsite}</div>`;
                    }
                    if (usuario.urlvideo) {
                        html += `<div class="data-value" style="margin-top: 5px;">üé¨ V√≠deo: ${usuario.urlvideo}</div>`;
                    }
                    if (usuario.urlnegocio) {
                        html += `<div class="data-value" style="margin-top: 5px;">üíº Neg√≥cio: ${usuario.urlnegocio}</div>`;
                    }
                    if (usuario.urlsound) {
                        html += `<div class="data-value" style="margin-top: 5px;">üîä √Åudio: ${usuario.urlsound}</div>`;
                    }
                    
                    html += `</div>`;
                }
                
                // √öltima mensagem
                if (usuario.mensagem) {
                    html += `
                        <div class="data-item" style="grid-column: 1 / -1; background: #1a252f;">
                            <div class="data-label">üí¨ √öLTIMA MENSAGEM</div>
                            <div class="data-value">${usuario.mensagem}</div>
                        </div>
                    `;
                }
                
                dataGrid.innerHTML = html;
                
                // Mostrar dados do usu√°rio
                userDataDiv.style.display = 'block';
                
                // Mensagem de sucesso
                messageDiv.className = 'message success';
                messageDiv.innerHTML = `‚úÖ Dados carregados com sucesso!`;
                messageDiv.style.display = 'block';
                
                // Salvar email no localStorage
                localStorage.setItem('user_email', email);
                
                loginBtn.disabled = false;
                loadingDiv.style.display = 'none';
                
            } catch (error) {
                messageDiv.className = 'message error';
                messageDiv.innerHTML = '‚ùå Erro ao buscar dados:<br>' + error.message;
                messageDiv.style.display = 'block';
                loginBtn.disabled = false;
                loadingDiv.style.display = 'none';
            }
        });

        // Verificar se j√° tem email no localStorage
        document.addEventListener('DOMContentLoaded', function() {
            const savedEmail = localStorage.getItem('user_email');
            if (savedEmail) {
                document.getElementById('email').value = savedEmail;
            }
        });
    </script>
</body>
</html>
